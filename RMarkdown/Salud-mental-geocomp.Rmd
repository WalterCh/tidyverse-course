---
title: "Salud Mental Geocomp"
author: "Walter Chanava"
date: "18/11/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = T,
  message = F,
  error = F,
  fig.align = 'center',
  warning = F
)
```

# Paquetes

```{r}
library(readr)
library(dplyr)
library(sf)
library(tmap)
```

# Datos

```{r}
salud_mental <- read_csv("../Data/salud_mental.csv",
                         locale = locale(encoding = "ISO-8859-1"),
                         col_names = TRUE,
                         col_types = NULL)
salud_mental
```

## Lectura de shapefile

```{r}
# shapefile
peru <- st_read("../Data/DEPARTAMENTOS.shp")
peru
```

## Union de shapefile con tabla de salud mental

```{r}
# join
salud_mental_geom <- salud_mental %>% 
  rename("DEPARTAMEN" = "Departamento") %>% 
  left_join(peru, by = "DEPARTAMEN")
salud_mental_geom
```

# EDA

### NroMes

```{r}
# Salud mental en Peru en el mes de Enero
salud_mental_geom_ene <- salud_mental_geom %>% 
  group_by(DEPARTAMEN, NroMes) %>% 
  summarise(Atenciones = sum(Atenciones)) %>% 
  filter(NroMes == 1) %>% 
  left_join(peru %>% select(DEPARTAMEN, geometry), by = "DEPARTAMEN")
salud_mental_geom_ene
```

```{r}
tmap_mode("view")

salud_mental_geom_ene %>% 
  st_as_sf() %>% 
  tm_shape() +
  tm_borders() + 
  tm_fill("Atenciones")
```

### Sexo

```{r}
salud_mental_geom %>% 
  group_by(DEPARTAMEN, Sexo) %>% 
  summarise(Atenciones = sum(Atenciones)) %>% 
  left_join(peru %>% select(DEPARTAMEN, geometry), by = "DEPARTAMEN") %>% 
  st_as_sf() %>% 
  tm_shape() +
  tm_borders() + 
  tm_facets(by = "Sexo") +
  tm_fill("Atenciones") 
```

### Dianostico

```{r}
tmap_mode("plot")
salud_mental_geom %>% 
  group_by(DEPARTAMEN, Diagnostico) %>% 
  summarise(Atenciones = sum(Atenciones)) %>% 
  left_join(peru %>% select(DEPARTAMEN, geometry), by = "DEPARTAMEN") %>% 
  st_as_sf() %>% 
  tm_shape() +
  tm_borders() + 
  tm_facets(by = "Diagnostico") +
  tm_fill("Atenciones")
```
